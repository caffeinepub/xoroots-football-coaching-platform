{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Inline video and PDF viewers for post attachments",
  "requirements": [
    {
      "id": "REQ-1",
      "summary": "Render video attachments as responsive inline players using the attachment direct blob URL.",
      "acceptanceCriteria": [
        "In the social feed, attachments detected as video (by mimeType starting with `video/` or filename extension match) render a playable inline `<video>` element with controls.",
        "The inline video player uses `attachment.blob.getDirectURL()` as its source and does not require downloading the file first.",
        "The inline video player layout is responsive and fits within the existing attachment grid without breaking card layout."
      ],
      "file_operations": [
        {
          "path": "frontend/src/utils/attachmentTypes.ts",
          "operation": "create",
          "description": "Add shared attachment type detection helpers (video/image/pdf by mimeType and filename extension) so video rendering rules are consistent across the app."
        },
        {
          "path": "frontend/src/components/PostAttachmentRenderer.tsx",
          "operation": "modify",
          "description": "Update video handling to render an inline HTML <video> player (controls enabled) sourced from `attachment.blob.getDirectURL()` (blob-storage ExternalBlob direct URL streaming/caching). Verify the component's usage instructions before implementing. Ensure the layout is responsive within the existing attachment grid (e.g., contain sizing, rounded corners, and not overflowing the card)."
        }
      ]
    },
    {
      "id": "REQ-2",
      "summary": "Render PDF attachments inline using the attachment direct blob URL with a fallback open-in-new-tab action.",
      "acceptanceCriteria": [
        "In the social feed, attachments detected as PDF (mimeType `application/pdf` or filename ending in `.pdf`) render an inline PDF viewer (e.g., `<iframe>`/`<embed>`) using `attachment.blob.getDirectURL()` as the source.",
        "PDFs are viewable in-place without requiring an explicit download action.",
        "If inline PDF viewing fails to load (e.g., browser restriction), the UI still provides a clear fallback link/button to open the PDF in a new tab."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/PostAttachmentRenderer.tsx",
          "operation": "modify",
          "description": "Update PDF handling to render an inline PDF viewer (<iframe> or <embed>) using `attachment.blob.getDirectURL()` (blob-storage ExternalBlob direct URL). Verify the component's usage instructions before implementing. Add a clear fallback control that opens the PDF in a new tab, and implement basic load-failure detection/state so the fallback is shown when inline viewing is blocked."
        }
      ]
    },
    {
      "id": "REQ-3",
      "summary": "Use the same inline viewer behavior everywhere attachments are rendered, including EditPostModal previews, while preserving existing image and fallback behaviors.",
      "acceptanceCriteria": [
        "In `EditPostModal`, existing attachments that are videos or PDFs use the same inline viewer behavior as in the feed.",
        "Image attachments continue to render inline as images as they do currently.",
        "Non-video/non-PDF/non-image attachments continue to render using the existing fallback download/open link UI."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/PostAttachmentRenderer.tsx",
          "operation": "modify",
          "description": "Refactor to rely on the shared attachment type detection utilities and ensure rendering branches remain: image => <img>, video => inline <video>, pdf => inline viewer with fallback, other => existing open/download UI. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/components/EditPostModal.tsx",
          "operation": "modify",
          "description": "Ensure attachment preview containers remain compatible with the updated inline viewers (video/PDF) by adjusting preview sizing classes as needed so inline viewers render cleanly in the modal grid without overflow, while keeping images and other file fallbacks unchanged."
        }
      ]
    }
  ]
}